"use strict";(self.webpackChunkhumanoid_robotics_book=self.webpackChunkhumanoid_robotics_book||[]).push([[3312],{28453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>o});var i=r(96540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}},74761:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>f,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-2-ros2-fundamentals/rclpy-python-robotics","title":"Chapter 2.3 - rclpy and Python Robotics","description":"Python Programming for ROS 2 Robotics","source":"@site/docs/module-2-ros2-fundamentals/rclpy-python-robotics.mdx","sourceDirName":"module-2-ros2-fundamentals","slug":"/module-2-ros2-fundamentals/rclpy-python-robotics","permalink":"/humanoid-robotics-book/docs/module-2-ros2-fundamentals/rclpy-python-robotics","draft":false,"unlisted":false,"editUrl":"https://github.com/ibrahimgem/humanoid-robotics-book/edit/main/docs/module-2-ros2-fundamentals/rclpy-python-robotics.mdx","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"Chapter 2.3 - rclpy and Python Robotics","description":"Python Programming for ROS 2 Robotics"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 2.2 - URDF and Robot Modeling","permalink":"/humanoid-robotics-book/docs/module-2-ros2-fundamentals/urdf-robot-modeling"},"next":{"title":"Chapter 2.4 - Advanced ROS 2 Patterns","permalink":"/humanoid-robotics-book/docs/module-2-ros2-fundamentals/advanced-ros2-patterns"}}');var s=r(74848),t=r(28453);const l={sidebar_position:8,title:"Chapter 2.3 - rclpy and Python Robotics",description:"Python Programming for ROS 2 Robotics"},o="Chapter 2.3: rclpy and Python Robotics",a={},c=[{value:"Goal",id:"goal",level:2},{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Setting Up rclpy",id:"setting-up-rclpy",level:2},{value:"Installation and Import",id:"installation-and-import",level:3},{value:"Basic Node Structure",id:"basic-node-structure",level:2},{value:"Publishers and Subscribers",id:"publishers-and-subscribers",level:2},{value:"Creating a Publisher",id:"creating-a-publisher",level:3},{value:"Creating a Subscriber",id:"creating-a-subscriber",level:3},{value:"Quality of Service (QoS) Settings",id:"quality-of-service-qos-settings",level:3},{value:"Services",id:"services",level:2},{value:"Service Server",id:"service-server",level:3},{value:"Service Client",id:"service-client",level:3},{value:"Actions",id:"actions",level:2},{value:"Action Server",id:"action-server",level:3},{value:"Action Client",id:"action-client",level:3},{value:"Parameters",id:"parameters",level:2},{value:"Declaring and Using Parameters",id:"declaring-and-using-parameters",level:3},{value:"Parameter Callbacks",id:"parameter-callbacks",level:3},{value:"Timers",id:"timers",level:2},{value:"Transformations (TF2)",id:"transformations-tf2",level:2},{value:"Advanced rclpy Concepts",id:"advanced-rclpy-concepts",level:2},{value:"Custom Message Types",id:"custom-message-types",level:3},{value:"Lifecycle Nodes",id:"lifecycle-nodes",level:3},{value:"Error Handling and Logging",id:"error-handling-and-logging",level:2},{value:"Proper Error Handling",id:"proper-error-handling",level:3},{value:"Logging Levels",id:"logging-levels",level:3},{value:"rclpy for Humanoid Robotics",id:"rclpy-for-humanoid-robotics",level:2},{value:"Joint State Publisher",id:"joint-state-publisher",level:3},{value:"Robot Control Interface",id:"robot-control-interface",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Node Organization",id:"node-organization",level:3},{value:"Performance Considerations",id:"performance-considerations",level:3},{value:"Code Structure",id:"code-structure",level:3},{value:"Summary",id:"summary",level:2},{value:"Exercises",id:"exercises",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"chapter-23-rclpy-and-python-robotics",children:"Chapter 2.3: rclpy and Python Robotics"})}),"\n",(0,s.jsx)(n.h2,{id:"goal",children:"Goal"}),"\n",(0,s.jsx)(n.p,{children:"Develop proficiency in rclpy for implementing robotic applications in Python."}),"\n",(0,s.jsx)(n.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,s.jsx)(n.p,{children:"After completing this chapter, students will create functional ROS 2 nodes using Python with proper message handling."}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"rclpy is the Python client library for ROS 2, providing Python bindings for the ROS 2 client library (rcl). It allows Python developers to create ROS 2 nodes, publish and subscribe to topics, provide and use services, and create action servers and clients. This chapter covers the essential concepts and techniques for developing robotic applications using rclpy."}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-rclpy",children:"Setting Up rclpy"}),"\n",(0,s.jsx)(n.p,{children:"Before using rclpy, ensure you have a properly configured ROS 2 environment:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"source /opt/ros/humble/setup.bash  # or your ROS 2 distribution\n"})}),"\n",(0,s.jsx)(n.h3,{id:"installation-and-import",children:"Installation and Import"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n"})}),"\n",(0,s.jsx)(n.h2,{id:"basic-node-structure",children:"Basic Node Structure"}),"\n",(0,s.jsx)(n.p,{children:"Every ROS 2 node built with rclpy follows the same basic structure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass MyNode(Node):\n    def __init__(self):\n        super().__init__('node_name')\n        # Initialize node components here\n        self.get_logger().info('Node initialized')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = MyNode()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"publishers-and-subscribers",children:"Publishers and Subscribers"}),"\n",(0,s.jsx)(n.h3,{id:"creating-a-publisher",children:"Creating a Publisher"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass MinimalPublisher(Node):\n    def __init__(self):\n        super().__init__('minimal_publisher')\n        self.publisher = self.create_publisher(String, 'topic_name', 10)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = f'Hello World: {self.i}'\n        self.publisher.publish(msg)\n        self.get_logger().info(f'Publishing: \"{msg.data}\"')\n        self.i += 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"creating-a-subscriber",children:"Creating a Subscriber"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass MinimalSubscriber(Node):\n    def __init__(self):\n        super().__init__('minimal_subscriber')\n        self.subscription = self.create_subscription(\n            String,\n            'topic_name',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'I heard: \"{msg.data}\"')\n"})}),"\n",(0,s.jsx)(n.h3,{id:"quality-of-service-qos-settings",children:"Quality of Service (QoS) Settings"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, DurabilityPolicy\n\n# Create a custom QoS profile\nqos_profile = QoSProfile(\n    depth=10,\n    reliability=ReliabilityPolicy.RELIABLE,\n    durability=DurabilityPolicy.VOLATILE\n)\n\n# Use with publisher\npublisher = self.create_publisher(String, 'topic_name', qos_profile)\n\n# Use with subscriber\nsubscription = self.create_subscription(\n    String,\n    'topic_name',\n    self.listener_callback,\n    qos_profile\n)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"services",children:"Services"}),"\n",(0,s.jsx)(n.h3,{id:"service-server",children:"Service Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass MinimalService(Node):\n    def __init__(self):\n        super().__init__('minimal_service')\n        self.srv = self.create_service(\n            AddTwoInts,\n            'add_two_ints',\n            self.add_two_ints_callback\n        )\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Request received: {request.a} + {request.b}')\n        return response\n"})}),"\n",(0,s.jsx)(n.h3,{id:"service-client",children:"Service Client"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\nfrom rclpy.qos import QoSProfile\n\nclass MinimalClient(Node):\n    def __init__(self):\n        super().__init__('minimal_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n\n        # Wait for service to be available\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n\n        self.request = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.request.a = a\n        self.request.b = b\n\n        # Call service asynchronously\n        future = self.cli.call_async(self.request)\n        return future\n"})}),"\n",(0,s.jsx)(n.h2,{id:"actions",children:"Actions"}),"\n",(0,s.jsx)(n.h3,{id:"action-server",children:"Action Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionServer, CancelResponse, GoalResponse\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionServer(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            execute_callback=self.execute_callback,\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback\n        )\n\n    def goal_callback(self, goal_request):\n        self.get_logger().info('Received goal request')\n        return GoalResponse.ACCEPT\n\n    def cancel_callback(self, goal_handle):\n        self.get_logger().info('Received cancel request')\n        return CancelResponse.ACCEPT\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.sequence = [0, 1]\n\n        for i in range(1, goal_handle.request.order):\n            # Check if cancel was requested\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n\n            feedback_msg.sequence.append(\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1])\n\n            # Publish feedback\n            goal_handle.publish_feedback(feedback_msg)\n\n            # Sleep to simulate work\n            time.sleep(1)\n\n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.sequence\n        self.get_logger().info(f'Returning result: {result.sequence}')\n        return result\n"})}),"\n",(0,s.jsx)(n.h3,{id:"action-client",children:"Action Client"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionClient(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_client')\n        self._action_client = ActionClient(\n            self,\n            Fibonacci,\n            'fibonacci'\n        )\n\n    def send_goal(self, order):\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        self._action_client.wait_for_server()\n        future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n        future.add_done_callback(self.goal_response_callback)\n        return future\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected')\n            return\n\n        self.get_logger().info('Goal accepted')\n        result_future = goal_handle.get_result_async()\n        result_future.add_done_callback(self.get_result_callback)\n\n    def feedback_callback(self, feedback_msg):\n        feedback = feedback_msg.feedback\n        self.get_logger().info(f'Received feedback: {feedback.sequence}')\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info(f'Result: {result.sequence}')\n"})}),"\n",(0,s.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsx)(n.h3,{id:"declaring-and-using-parameters",children:"Declaring and Using Parameters"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass ParameterNode(Node):\n    def __init__(self):\n        super().__init__('parameter_node')\n\n        # Declare parameters with default values\n        self.declare_parameter('param1', 'default_value')\n        self.declare_parameter('param2', 42)\n        self.declare_parameter('param3', 3.14)\n\n        # Get parameter values\n        param1_value = self.get_parameter('param1').value\n        param2_value = self.get_parameter('param2').value\n        param3_value = self.get_parameter('param3').value\n\n        self.get_logger().info(f'param1: {param1_value}')\n        self.get_logger().info(f'param2: {param2_value}')\n        self.get_logger().info(f'param3: {param3_value}')\n\n        # Set parameters programmatically\n        self.set_parameters([rclpy.parameter.Parameter('param1', value='new_value')])\n"})}),"\n",(0,s.jsx)(n.h3,{id:"parameter-callbacks",children:"Parameter Callbacks"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rclpy.parameter import Parameter\n\ndef parameter_callback(self, parameters):\n    for param in parameters:\n        if param.name == 'my_param' and param.type_ == Parameter.Type.STRING:\n            self.get_logger().info(f'Parameter {param.name} changed to {param.value}')\n    return SetParametersResult(successful=True)\n\n# Register the callback\nself.add_on_set_parameters_callback(self.parameter_callback)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"timers",children:"Timers"}),"\n",(0,s.jsx)(n.p,{children:"Timers allow you to execute code at regular intervals:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass TimerNode(Node):\n    def __init__(self):\n        super().__init__('timer_node')\n\n        # Create a timer that calls a callback every 0.5 seconds\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.counter = 0\n\n    def timer_callback(self):\n        self.get_logger().info(f'Timer callback: {self.counter}')\n        self.counter += 1\n"})}),"\n",(0,s.jsx)(n.h2,{id:"transformations-tf2",children:"Transformations (TF2)"}),"\n",(0,s.jsx)(n.p,{children:"TF2 is ROS's system for tracking coordinate frame transformations:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom tf2_ros import TransformBroadcaster\nfrom geometry_msgs.msg import TransformStamped\n\nclass FramePublisher(Node):\n    def __init__(self):\n        super().__init__('frame_publisher')\n        self.tf_broadcaster = TransformBroadcaster(self)\n\n        # Create a timer to broadcast transforms\n        self.timer = self.create_timer(0.1, self.broadcast_transform)\n\n    def broadcast_transform(self):\n        t = TransformStamped()\n\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'base_link'\n        t.child_frame_id = 'laser_frame'\n\n        t.transform.translation.x = 0.1\n        t.transform.translation.y = 0.0\n        t.transform.translation.z = 0.2\n        t.transform.rotation.x = 0.0\n        t.transform.rotation.y = 0.0\n        t.transform.rotation.z = 0.0\n        t.transform.rotation.w = 1.0\n\n        self.tf_broadcaster.sendTransform(t)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"advanced-rclpy-concepts",children:"Advanced rclpy Concepts"}),"\n",(0,s.jsx)(n.h3,{id:"custom-message-types",children:"Custom Message Types"}),"\n",(0,s.jsx)(n.p,{children:"To use custom messages, first define them in a package:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# In your node\nfrom my_robot_msgs.msg import JointStateExtended\n\nclass CustomMessageNode(Node):\n    def __init__(self):\n        super().__init__('custom_message_node')\n        self.publisher = self.create_publisher(JointStateExtended, 'joint_states_extended', 10)\n\n    def publish_custom_message(self):\n        msg = JointStateExtended()\n        msg.name = ['joint1', 'joint2', 'joint3']\n        msg.position = [0.1, 0.2, 0.3]\n        msg.velocity = [0.0, 0.0, 0.0]\n        msg.effort = [0.0, 0.0, 0.0]\n        msg.temperature = [25.0, 26.0, 24.5]  # Additional field\n\n        self.publisher.publish(msg)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"lifecycle-nodes",children:"Lifecycle Nodes"}),"\n",(0,s.jsx)(n.p,{children:"Lifecycle nodes provide better control over node states:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from lifecycle_msgs.msg import Transition\nfrom lifecycle_msgs.srv import ChangeState\nfrom rclpy.lifecycle import LifecycleNode, TransitionCallbackReturn\n\nclass LifecycleTestNode(LifecycleNode):\n    def __init__(self):\n        super().__init__('lifecycle_test_node')\n        self.get_logger().info('Created lifecycle test node')\n\n    def on_configure(self, state):\n        self.get_logger().info('Configuring lifecycle test node')\n        return TransitionCallbackReturn.SUCCESS\n\n    def on_activate(self, state):\n        self.get_logger().info('Activating lifecycle test node')\n        return TransitionCallbackReturn.SUCCESS\n\n    def on_deactivate(self, state):\n        self.get_logger().info('Deactivating lifecycle test node')\n        return TransitionCallbackReturn.SUCCESS\n\n    def on_cleanup(self, state):\n        self.get_logger().info('Cleaning up lifecycle test node')\n        return TransitionCallbackReturn.SUCCESS\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-handling-and-logging",children:"Error Handling and Logging"}),"\n",(0,s.jsx)(n.h3,{id:"proper-error-handling",children:"Proper Error Handling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom rclpy.exceptions import ParameterNotDeclaredException\n\nclass ErrorHandlingNode(Node):\n    def __init__(self):\n        super().__init__('error_handling_node')\n\n        # Safe parameter access\n        try:\n            param_value = self.get_parameter('my_param').value\n        except ParameterNotDeclaredException:\n            self.get_logger().warn('Parameter not declared, using default')\n            param_value = 'default'\n\n        # Safe subscription\n        try:\n            self.subscription = self.create_subscription(\n                String,\n                'topic',\n                self.callback,\n                10\n            )\n        except Exception as e:\n            self.get_logger().error(f'Failed to create subscription: {e}')\n"})}),"\n",(0,s.jsx)(n.h3,{id:"logging-levels",children:"Logging Levels"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Different logging levels\nself.get_logger().debug('Debug message')\nself.get_logger().info('Info message')\nself.get_logger().warn('Warning message')\nself.get_logger().error('Error message')\nself.get_logger().fatal('Fatal message')\n"})}),"\n",(0,s.jsx)(n.h2,{id:"rclpy-for-humanoid-robotics",children:"rclpy for Humanoid Robotics"}),"\n",(0,s.jsx)(n.h3,{id:"joint-state-publisher",children:"Joint State Publisher"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nfrom std_msgs.msg import Header\n\nclass JointStatePublisher(Node):\n    def __init__(self):\n        super().__init__('joint_state_publisher')\n        self.publisher = self.create_publisher(JointState, 'joint_states', 10)\n\n        # Timer for publishing joint states\n        self.timer = self.create_timer(0.05, self.publish_joint_states)  # 20 Hz\n\n        # Initialize joint positions\n        self.joint_names = [\n            'left_hip_joint', 'left_knee_joint', 'left_ankle_joint',\n            'right_hip_joint', 'right_knee_joint', 'right_ankle_joint',\n            'left_shoulder_joint', 'left_elbow_joint',\n            'right_shoulder_joint', 'right_elbow_joint'\n        ]\n        self.joint_positions = [0.0] * len(self.joint_names)\n\n    def publish_joint_states(self):\n        msg = JointState()\n        msg.header = Header()\n        msg.header.stamp = self.get_clock().now().to_msg()\n        msg.header.frame_id = 'base_link'\n\n        msg.name = self.joint_names\n        msg.position = self.joint_positions\n        msg.velocity = [0.0] * len(self.joint_names)\n        msg.effort = [0.0] * len(self.joint_names)\n\n        self.publisher.publish(msg)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"robot-control-interface",children:"Robot Control Interface"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom trajectory_msgs.msg import JointTrajectory, JointTrajectoryPoint\nfrom control_msgs.msg import JointTrajectoryControllerState\n\nclass RobotController(Node):\n    def __init__(self):\n        super().__init__('robot_controller')\n\n        # Publishers for commanding joints\n        self.command_publisher = self.create_publisher(\n            JointTrajectory,\n            '/joint_trajectory_controller/joint_trajectory',\n            10\n        )\n\n        # Subscribers for feedback\n        self.state_subscriber = self.create_subscription(\n            JointTrajectoryControllerState,\n            '/joint_trajectory_controller/state',\n            self.state_callback,\n            10\n        )\n\n        # Service clients for additional control\n        self.trajectory_client = self.create_client(\n            FollowJointTrajectory,\n            '/joint_trajectory_controller/follow_joint_trajectory'\n        )\n\n    def send_trajectory_command(self, joint_names, positions, velocities=None, time_from_start=1.0):\n        traj = JointTrajectory()\n        traj.joint_names = joint_names\n\n        point = JointTrajectoryPoint()\n        point.positions = positions\n        if velocities:\n            point.velocities = velocities\n\n        # Set time from start (in seconds)\n        point.time_from_start.sec = int(time_from_start)\n        point.time_from_start.nanosec = int((time_from_start % 1) * 1e9)\n\n        traj.points = [point]\n\n        self.command_publisher.publish(traj)\n\n    def state_callback(self, msg):\n        # Process feedback from the controller\n        self.get_logger().debug(f'Received feedback for joints: {msg.joint_names}')\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"node-organization",children:"Node Organization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Keep nodes focused on a single responsibility"}),"\n",(0,s.jsx)(n.li,{children:"Use appropriate QoS settings for different data types"}),"\n",(0,s.jsx)(n.li,{children:"Implement proper error handling and logging"}),"\n",(0,s.jsx)(n.li,{children:"Use meaningful names for topics, services, and actions"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Choose appropriate timer frequencies"}),"\n",(0,s.jsx)(n.li,{children:"Use appropriate message queue sizes"}),"\n",(0,s.jsx)(n.li,{children:"Consider the impact of logging on performance"}),"\n",(0,s.jsx)(n.li,{children:"Use asynchronous operations when possible"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"code-structure",children:"Code Structure"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Organize nodes in separate classes"}),"\n",(0,s.jsx)(n.li,{children:"Use constants for magic numbers and strings"}),"\n",(0,s.jsx)(n.li,{children:"Follow Python coding standards (PEP 8)"}),"\n",(0,s.jsx)(n.li,{children:"Document your code properly"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"rclpy provides a powerful interface for developing ROS 2 nodes in Python. Understanding publishers, subscribers, services, actions, and parameters is essential for creating robust robotic applications. The examples in this chapter provide a foundation for developing more complex humanoid robotics applications using Python."}),"\n",(0,s.jsx)(n.h2,{id:"exercises",children:"Exercises"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a joint state publisher for a humanoid robot with at least 12 joints"}),"\n",(0,s.jsx)(n.li,{children:"Implement a service that calculates forward kinematics for a humanoid arm"}),"\n",(0,s.jsx)(n.li,{children:"Create an action server that executes a walking pattern for a humanoid robot"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.p,{children:['[1] ROS 2 Documentation, "rclpy User Guide," ',(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/rolling/p/rclpy/",children:"https://docs.ros.org/en/rolling/p/rclpy/"})]}),"\n",(0,s.jsxs)(n.p,{children:['[2] ROS 2 Documentation, "Nodes in Python," ',(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/rolling/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Node.html",children:"https://docs.ros.org/en/rolling/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Node.html"})]}),"\n",(0,s.jsxs)(n.p,{children:['[3] ROS 2 Documentation, "Publisher/Subscriber in Python," ',(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/rolling/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html",children:"https://docs.ros.org/en/rolling/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html"})]})]})}function f(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);